# 编写测试命令

编写单元测试和集成测试

## 说明

请遵循以下系统方法编写有效的测试：**$ARGUMENTS**

1. **测试框架检测**
   - 确定正在使用的测试框架（Jest、Mocha、PyTest、RSpec 等）
   - 审查现有的测试结构和约定
   - 检查测试配置文件和设置
   - 了解项目特定的测试模式

2. **测试代码分析**
   - 分析需要测试的代码
   - 确定公共接口和关键业务逻辑
   - 规划依赖关系和外部交互
   - 了解错误条件和边缘情况

3. **测试策略规划**
   - 确定所需的测试级别：
     - 单个函数/方法的单元测试
     - 组件交互的集成测试
     - 用户工作流的端到端测试
   - 规划测试覆盖率目标和优先级
   - 确定模拟和存根需求

4. **单元测试实施**
   - 单独测试单个函数和方法
   - 优先覆盖快乐路径场景
   - 测试边缘情况和边界条件
   - 测试错误条件和异常处理
   - 使用适当的断言和期望

5. **测试结构和组织**
   - 遵循 AAA 模式（Arrange、Act、Assert）
   - 使用描述性测试名称来解释场景
   - 使用测试套件/描述块对相关测试进行分组
   - 保持测试的专注性和原子性

6. **模拟和存根**
   - 模拟外部依赖和服务
   - 为单元测试存根复杂操作
   - 使用适当的隔离机制以确保测试的可靠性
   - 避免过度模拟导致测试变得脆弱

7. **数据设置和拆卸**
   - 创建测试夹具和示例数据
   - 干净地设置和拆卸测试环境
   - 使用工厂或构建器处理复杂的测试数据
   - 确保测试之间互不干扰

8. **集成测试编写**
   - 测试组件交互和数据流
   - 使用各种场景测试 API 端点
   - 测试数据库操作和事务
   - 测试外部服务集成

9. **错误和异常测试**
   - 测试所有错误条件和异常路径
   - 验证正确的错误消息和代码
   - 测试错误恢复和回退机制
   - 测试验证和安全场景

10. **性能和负载测试**
    - 为关键操作添加性能测试
    - 在不同的负载条件下进行测试
    - 验证内存使用情况和资源清理
    - 测试超时和速率限制场景

11. **安全测试**
    - 测试身份验证和授权
    - 测试输入验证和清理
    - 测试常见安全漏洞
    - 测试访问控制和权限

12. **无障碍测试（针对 UI）**
    - 测试键盘导航和屏幕阅读器
    - 测试颜色对比度和视觉无障碍功能
    - 测试 ARIA 属性和语义标记
    - 使用辅助技术模拟进行测试

13. **跨平台测试**
    - 在不同操作系统上测试
    - 在不同浏览器上测试（针对 Web 应用）
    - 在不同设备尺寸和分辨率上测试
    - 使用不同版本的依赖项进行测试

14. **测试实用程序和助手**
    - 创建可复用的测试实用程序和助手
    - 构建测试数据工厂和构建器
    - 创建自定义匹配器和断言
    - 设置通用测试设置和拆卸函数

15. **快照和可视化测试**
    - 对 UI 组件使用快照测试
    - 实施可视化回归测试
    - 测试渲染输出和标记
    - 正确进行版本控制快照

16. **异步测试**
    - 正确测试异步操作
    - 使用合适的异步测试模式
    - 测试 Promise 的解析和拒绝
    - 测试回调和事件驱动代码

17. **测试文档**
    - 记录复杂的测试场景和推理
    - 为不明显的测试逻辑添加注释
    - 创建测试文档供团队参考
    - 记录测试数据需求和设置

18. **测试维护**
    - 使测试与代码变更保持同步
    - 代码重构时重构测试
    - 删除过时的测试并更新断言
    - 监控并修复不稳定的测试

**特定框架指南：**

**Jest/JavaScript：**
```javascript
describe('ComponentName', () => {
  beforeEach(() => {
    // 设置
  });

  it('should handle valid input properly', () => {
    // 安排
    const input = 'test';
    // 执行
    const result = functionToTest(input);
    // 断言
    期望（结果）.toBe（预期值）；
  }）；
}）；
```

**PyTest/Python:**
```python
class TestClassName:
    def setup_method(self):
        # Setup
        pass

    def test_should_handle_valid_input(self):
        # Arrange
        input_data = "test"
        # Act
        result = function_to_test(input_data)
        # Assert
        assert result == expected_value
```

**RSpec/Ruby:**
```ruby
RSpec.describe ClassName do
  describe '#method_name' do
    it 'handles valid input correctly' do
      # Arrange
      input = 'test'
      # Act
      result = subject.method_name(input)
      # Assert
      expect(result).to eq(expected_value)
    end
  end
end
```

记住首先优先测试关键业务逻辑和面向用户的功能，然后将覆盖范围扩展到支持代码。