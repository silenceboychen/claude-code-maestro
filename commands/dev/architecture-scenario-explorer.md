# 架构场景探索

通过系统化的场景分析，结合权衡评估和未来发展规划，探索架构决策。

## 说明

您的任务是通过全面的场景建模，系统地探索架构决策，以优化系统设计选择。请遵循以下方法：**$ARGUMENTS**

### 1. 先决条件评估

**关键架构上下文验证：**

- **系统范围**：您正在设计的系统或组件架构是什么？
- **规模要求**：预期的使用模式和增长预测是什么？
- **约束**：有哪些技术、业务或资源约束？
- **时间表**：实施时间表和发展路线图是什么？
- **成功标准**：您将如何衡量架构的成功？

**如果上下文不清晰，请系统地指导：**

```
缺少系统范围：
“需要探索哪些具体的系统架构？
- 新系统设计：全新应用或服务架构
- 系统迁移：从传统架构迁移到现代架构
- 扩展架构：扩展现有系统功能
- 集成架构：连接多个系统和服务
- 平台架构：构建基础设施

请具体说明系统边界、关键组件和主要功能。”

缺少规模要求：
“预期的系统规模和使用模式是什么？
- 用户规模：并发用户数和总用户数
- 数据规模：处理的数据量、速度和种类
- 事务规模：每秒请求数、峰值负载模式
- 地理规模：单区域、多区域还是全球分布
- 增长预测：预期的扩展时间表和幅度”
```

### 2. 架构选项生成

**系统地识别架构方法：**

#### 架构模式矩阵
```
架构方法框架：

单体架构模式：
- 分层架构：传统的 n 层架构，具有清晰的分离
- 模块化单体架构：单一部署中模块界限清晰
- 插件架构：核心系统，具有可扩展的插件生态系统
- 面向服务的单体架构：内部服务边界清晰，单一部署

分布式模式：
- 微服务：独立服务，业务能力一致
- 服务网格：微服务，具有基础设施级通信
- 事件驱动：异步通信，具有事件溯源
- CQRS/事件溯源：命令查询分离，具有事件存储

混合模式：
- 模块化微服务：按业务领域分组的服务
- 微前端：前端分解，匹配后端服务
- Strangler Fig：从单体架构逐步迁移到分布式架构
- API 网关：集中式入口点，具有后端服务路由

云原生模式：
- 无服务器：基于云提供商基础设施的功能
- 容器原生：Kubernetes 优先，提供云原生服务
- 多云：云无关，提供可移植的基础设施
- 边缘优先：分布式计算，提供边缘位置优化
```

#### 架构变体规范
```
针对每个架构选项：

结构特征：
- 组件组织：[系统各部分的结构和关联方式]
- 通信模式：[同步 vs. 异步、协议、消息传递]
- 数据管理：[数据库策略、一致性模型、存储模式]
- 部署模型：[打包、分发、扩展和运维方法]

质量属性：
- 可扩展性概况：[水平 vs. 垂直扩展、瓶颈分析]
- 可靠性特征：[故障模式、恢复、容错能力]
- 性能预期：[延迟、吞吐量、资源效率]
- 安全模型：[身份验证、授权、数据保护、攻击面]

实施注意事项：
- 技术栈：[语言、框架、数据库、基础架构]
- 团队结构契合度：[康威定律的含义、团队能力]
- 开发流程：[构建、测试、部署、监控工作流]
- 演进策略：[架构如何发展和变化随着时间的推移]
```

### 3. 场景框架开发

**创建全面的架构测试场景：**

#### 使用场景矩阵
```
多维场景框架：

负载场景：
- 正常运行：典型的日常使用模式和流量
- 峰值负载：预期的最大并发使用量和交易量
- 压力测试：超出正常容量以识别临界点
- 峰值测试：流量突然增加和突发处理

增长场景：
- 线性增长：用户和数据量随时间稳步增长
- 指数增长：快速扩展需求和病毒式采用
- 地域扩展：多区域部署和全球扩展
- 功能扩展：新功能和服务添加

故障场景：
- 组件故障：单个服务或数据库中断
- 基础设施故障：网络、存储或计算中断
- 级联故障：故障传播和系统级影响
- 灾难恢复：重大中断恢复和业务连续性

演进场景：
- 技术迁移：框架、语言或平台变更
- 商业模式变更：新的收入来源或服务产品
- 监管变化：合规性要求和数据保护
- 竞争反应：市场压力和功能需求
```

#### 场景影响建模
- 每种场景类型下的性能影响
- 对基础设施和运营的成本影响
- 对开发速度和团队生产力的影响
- 风险评估和缓解要求

### 4. 权衡分析框架

**架构权衡的系统评估：**

#### 质量属性权衡矩阵
```
架构质量评估：

性能权衡：
- 延迟 vs 吞吐量：响应时间 vs 最大并发处理能力
- 内存 vs CPU：资源利用率优化策略
- 一致性 vs 可用性：CAP 定理含义和选择
- 缓存 vs 新鲜度：数据过时 vs 响应速度

可扩展性权衡：
- 水平 vs 垂直：基础设施扩展方法和经济性
- 无状态 vs 有状态：会话管理和性能影响
- 同步 vs 异步：通信复杂性 vs 性能
- 耦合 vs 自治：服务独立性 vs 运营开销

开发权衡：
- 开发速度 vs 运行时性能：优化时间投入
- 类型安全与灵活性：编译时与运行时错误处理
- 代码重用与服务独立性：共享库与重复
- 测试复杂性与系统可靠性：测试投资与质量

运营权衡：
- 复杂性与控制：托管服务与自管理基础设施
- 监控与隐私：可观察性与数据保护
- 自动化与灵活性：标准化与定制化
- 成本与性能：基础设施支出与响应时间
```

#### 决策矩阵构建
- 根据业务优先级为不同质量属性分配权重
- 针对每个架构选项在质量维度上的评分方法
- 权重和分数变化的敏感性分析
- 非支配解决方案的帕累托前沿识别

### 5. 面向未来评估

**评估架构适应性和演进潜力：**

#### 技术演进场景
```
面向未来分析框架：

技术趋势整合：
- 人工智能/机器学习整合：机器学习能力的嵌入和扩展
- 边缘计算：分布式处理和低延迟要求
- 量子计算：后量子密码学及其计算影响
- 区块链/分布式账本技术：分布式账本集成和信任机制

市场演进准备：
- 商业模式灵活性：订阅、市场、平台转型
- 全球扩张：多租户、多区域、多监管合规
- 客户期望演变：实时、个性化、全渠道体验
- 竞争格局变化：功能对等性和差异化要求

面向未来的监管：
- 隐私法规：GDPR、CCPA 的演变和全球隐私要求
- 安全标准：零信任、合规框架的演变
- 数据主权：地理数据驻留和跨境限制
- 无障碍要求：包容性设计和辅助技术支持
```

#### 适应性评分
- 架构灵活性，可应对需求变化
- 技术迁移的可行性和成本
- 团队技能演进和学习曲线管理
- 投资保护和技术债务管理

### 6. 架构模拟引擎

**模拟不同场景下的架构行为：**

#### 性能模拟框架
```
多层架构模拟：

组件级模拟：
- 单个服务的性能特征和资源使用情况
- 数据库查询性能和优化机会
- 缓存命中率和失效策略
- 消息队列吞吐量和延迟模式

集成级模拟：
- 服务间通信开销和优化
- API 网关性能和路由效率
- 负载均衡器分布和健康检查
- 熔断器和重试机制的有效性

系统级模拟：
- 端到端请求流和用户体验
- 峰值负载分布和资源分配
- 故障传播和恢复模式
- 监控和报警系统有效性

基础设施级模拟：
- 云资源利用率和自动扩展行为
- 网络带宽和延迟优化
- 存储性能和数据一致性模式
- 安全策略执行和性能影响
```

#### 成本建模集成
- 不同场景下的基础设施成本估算
- 开发和运营成本预测
- 多年期总体拥有成本分析
- 成本优化机会及权衡分析

### 7. 风险评估与缓解

**全面的架构风险评估：**

#### 技术风险框架
```
架构风险评估：

实施风险：
- 技术成熟度：新技术与成熟技术的采用风险
- 复杂性管理：系统理解和调试挑战
- 集成挑战：第三方服务依赖性和兼容性
- 性能不确定性：未经测试的扩展和优化要求

运营风险：
- 部署复杂性：发布管理和回滚功能
- 监控差距：可观察性和故障排除的局限性
- 扩展挑战：自动扩展的可靠性和成本控制
- 灾难恢复：备份、恢复和业务连续性规划

战略风险：
- 技术锁定：供应商依赖性和迁移灵活性
- 技能依赖性：团队专业知识要求和知识差距
- 演进约束：架构修改和扩展限制
- 竞争劣势：上市时间和功能开发速度
```

#### 风险缓解策略制定
- 针对已识别风险的具体缓解方法
- 应急计划和替代架构方案
- 预警指标和监测策略
- 风险接受标准和利益相关者沟通

### 8. 决策框架和建议

**生成系统性架构指导：**

#### 架构决策记录 (ADR) 格式
```
## 架构决策：[系统名称] - [决策主题]

### 背景和问题陈述
- 业务需求：[关键功能性和非功能性需求]
- 当前约束：[技术、资源和时间限制]
- 决策驱动因素：[影响架构选择的因素]

### 考虑的架构选项

#### 选项 1：[架构名称]
- 描述：[架构方法和主要特征]
- 优点：[优势和好处]
- 缺点：[劣势和风险]
- 权衡：[具体质量属性影响]

[对每个选项重复]

### 决策结果
- 选定的架构：[选择的方法及其理由]
- 决策理由：[选择此选项的原因]
- 预期收益：[预期优势和成功指标]
- 可接受的权衡：[妥协和缓解措施]策略]

### 实施策略
- 第一阶段（立即）：[初始实施步骤和验证]
- 第二阶段（短期）：[核心系统开发和集成]
- 第三阶段（中期）：[优化和扩展实施]
- 第四阶段（长期）：[演进和增强路线图]

### 验证和成功标准
- 绩效指标：[具体 KPI 和可接受范围]
- 质量门：[架构合规性和验证检查点]
- 审查时间表：[何时重新评估架构决策]
- 适应性触发因素：[需要修改架构的情况]

### 风险和缓解措施
- 高优先级风险：[最重要的问题和应对措施]
- 监控策略：[预警系统和健康检查]
- 应急计划：[出现问题时的替代方案]
- 学习和适应：[如何整合反馈并改进]
```

### 9. 持续架构演进

**建立持续的架构评估和改进机制：**

#### 架构健康监测
- 根据架构预测跟踪性能指标
- 技术债务积累和补救计划
- 团队生产力和开发速度衡量
- 用户满意度与业务成果关联

#### 演进式架构实践
- 定期架构评审和适应度函数评估
- 增量改进识别和实施
- 技术趋势评估和采用规划
- 跨团队架构知识共享和标准化

## 使用示例

```bash
# 微服务迁移规划
/dev:architecture-scenario-explorer 评估用户量超过 100 万的电商平台从单体应用到微服务的迁移

# 新系统架构设计
/dev:architecture-scenario-explorer 为每秒处理 10 万事件的实时分析平台设计架构

# 扩展架构评估
/dev:architecture-scenario-explorer 分析将社交媒体平台从每日活跃用户量从 1 万扩展到 100 万的架构方案用户

# 技术现代化规划
/dev:architecture-scenario-explorer 比较无服务器架构与容器原生架构在数据处理管道现代化方面的应用
```

## 质量指标

- **绿色**：已分析多种架构，全面测试场景，并已验证权衡利弊
- **黄色**：已考虑部分架构选项，基本覆盖场景，并已预估权衡利弊
- **红色**：仅关注单一架构，场景分析有限，假设未经验证

## 常见陷阱

- 架构太空化：过度设计理论需求而非实际需求
- 架构货物崇拜：在不了解具体情况的情况下照搬成功模式
- 技术偏见：根据技术偏好而非需求选择架构
- 过早优化：解决尚不存在的性能问题
- 过度追求可扩展性：过度优化可能永远不会实现的规模
- 盲目演进：未规划架构的变更和发展

通过全面的场景探索和权衡利弊分析，将架构决策从基于意见的争论转变为系统性的、基于证据的选择。