# 生成线性工作日志

您的任务是根据最近的 git 提交，为线性问题生成技术工作日志注释。

## 说明

1. **检查 Linear MCP 可用性**
   - 验证 Linear MCP 工具是否可用（mcp__linear__* 函数）
   - 如果未安装 Linear MCP，请告知用户安装并提供安装说明
   - 如果 Linear MCP 不可用，请勿继续生成工作日志

2. **检查现有工作日志**
   - 使用 Linear MCP 获取问题的现有评论
   - 查找日期为当天、格式为“## 工作完成 [今日日期]”的评论
   - 如果找到，请记录现有内容以进行追加/更新，而不是重复

3. **提取 Git 信息**
   - 获取当前分支名称
   - 获取当前分支上的最近提交（最近 10 次提交）
   - 获取当前分支上但不在主分支上的提交
   - 获取每个相关提交的详细信息，包括文件更改和行数
   - 关注自上次工作日志更新以来的提交（如果有）

4. **生成工作日志内容**
   - 使用尽量使用枯燥的专业术语，避免使用形容词或表情符号
   - 专注于实际的实现细节
   - 用日期、分支和提交信息构建日志
   - 在相关位置添加量化指标（文件数、行数）
   - 避免使用主观评论或宣传性语言

5. **处理现有工作日志**
   - 如果今日没有工作日志：创建新评论
   - 如果今日有工作日志：用包含今日所有工作的更新内容替换现有评论
   - 确保提交按时间顺序排列
   - 包含今日完成的先前工作和新工作

6. **格式结构**
  ```
  ## 已完成工作 [今日日期]

  ### 分支：[当前分支名称]

  **提交 [短哈希]：[提交标题]**
  - [技术细节 1]
  - [技术细节 2]
  - [文件数] 个文件中的 [行数] 行代码

  [按时间顺序排列的其他提交]

  ### [状态部分]
  - [当前基础设施/测试状态]
  - [当前可用/准备就绪的内容]
  ```

7. **发布到 Linear**
   - 使用 Linear MCP 集成创建或更新评论
   - 发布格式化的评论将工作日志发布到指定的 Linear 问题
   - 如果更新，则替换整个现有工作日志评论
   - 确认发布成功

## Git 命令使用指南
- `git branch --show-current` - 获取当前分支
- `git log --oneline -10` - 获取最近的提交
- `git log main..HEAD --oneline` - 获取特定分支的提交
- `git show --stat [commit-hash]` - 获取详细的提交信息
- `git log --since="[today's date]" --pretty=format:"%h %ad %s" --date=short` - 获取今天的提交

## 内容指南
- 包含提交哈希值和描述性标题
- 提供具体的技术实现
- 包含重大更改的文件数和行数
- 保持一致的格式
- 重点介绍技术成就
- 包含当前状态摘要
- 禁止使用表情符号或特殊字符

## 错误处理
- 继续操作前，请检查 Linear MCP 客户端是否可用
- 如果 Linear MCP 不可用，则显示安装说明：
  ```
  Linear MCP 客户端未安装。安装方法：

  1. 安装 Linear MCP 服务器：
  npm install -g @modelcontextprotocol/server-linear

  2. 将 Linear MCP 添加到您的 Claude 配置中：
  将以下内容添加到您的 Claude MCP 设置中：
  {
    "mcpServers": {
      "linear": {
        "command": "npx",
        "args": ["@modelcontextprotocol/server-linear"],
        "env": {
          "LINEAR_API_KEY": "your_linear_api_key_here"
        }
      }
    }
  }

  3. 重启 Claude 代码
  4. 从以下网址获取您的 Linear API 密钥：https://linear.app/settings/api
  ```
- 验证 Linear 工单 ID 是否存在
- 处理未找到最近提交的情况
- 为 Git 操作失败提供清晰的错误消息
- 确认评论发布成功

## 示例用法
使用以下命令调用`/generate-linear-worklog BLA2-2`，该命令应该：
1. 分析当前分支上的 git 提交
2. 生成结构化工作日志
3. 将评论发布到 Linear 问题 BLA2-2
4. 确认发布成功