# 设置自动发布

设置自动发布工作流程

## 说明

按照行业最佳实践设置自动发布：

1. **分析代码库结构**
- 检测项目类型（Node.js、Python、Go 等）
- 检查现有的 CI/CD 工作流程
- 确定当前的版本控制方法
- 审查现有的发布流程

2. **创建版本跟踪**
- 对于 Node.js：使用 package.json 中的 version 字段
- 对于 Python：在 __init__.py 或 pyproject.toml 中使用 __version__
- 对于 Go：在 go.mod 中使用 version
- 对于其他语言：创建 version.txt 文件
- 确保版本遵循语义版本控制（MAJOR.MINOR.PATCH）

3. **设置约定式提交**
- 创建 CONTRIBUTING.md 文件，并遵循以下提交约定：
  - `feat:` 用于新功能（minor bump）
  - `fix:` 用于错误修复（patch bump）
  - `feat!:` 或`BREAKING CHANGE:` 用于重大变更（重大改进）
  - `docs:`、`chore:`、`style:`、`refactor:`、`test:` 用于非发布变更
- 包含每种类型的示例和指南

1. **创建拉取请求模板**
- 添加 `.github/pull_request_template.md`
- 包含常规提交提醒
- 添加常见需求清单
- 参考贡献指南

5. **创建发布工作流**
- 添加 `.github/workflows/release.yml`：
  - 推送到主分支时触发
  - 分析自上次发布以来的提交
  - 确定版本升级类型
  - 在相应的文件中更新版本
  - 根据提交生成发布说明
  - 更新 CHANGELOG.md
  - 创建 git 标签
  - 创建 GitHub 发布版本
  - 附加分发工件
- 包含强制发布的手动触发选项

6. **创建 PR 验证工作流**
- 添加 `.github/workflows/pr-check.yml`：
  - 验证 PR 标题是否符合常规格式
  - 检查提交信息
  - 提供版本影响反馈
  - 运行测试和质量检查

7. **配置 GitHub 发布说明**
- 创建 `.github/release.yml`
- 为不同变更类型定义类别
- 配置变更日志排除项
- 设置贡献者认可

8. **更新文档**
- 在 README 中添加发布徽章：
  - 当前版本徽章
  - 最新版本徽章
  - 构建状态徽章
- 文档发布流程
- 添加 CONTRIBUTING.md 链接
- 解释版本升级规则

9. **设置变更日志管理**
- 确保 CHANGELOG.md 遵循“保持变更日志”格式
- 添加 [未发布] 部分，用于记录即将发生的变更
- 配置自动更新变更日志
- 设置变更日志类别

10. **配置分支保护**
- 推荐分支保护规则：
  - 要求 PR 审核
  - 要求状态检查
  - 要求使用常规 PR 标题
  - 忽略过时的审核
- 记录推荐设置

11.  **添加安全扫描**
- 设置 Dependabot 以进行依赖项更新
- 配置安全警报
- 根据需要添加安全策略

12.  **测试系统**
- 创建使用常规标题的示例 PR
- 验证 PR 检查是否正常工作
- 测试手动发布触发器
- 验证变更日志生成

参数：$ARGUMENTS

### 其他注意事项

**对于 Monorepos：**
- 为每个包设置独立的版本控制
- 为每个包配置变更日志
- 使用约定式提交范围

**对于库：**
- 包含 API 兼容性检查
- 生成 API 文档
- 添加重大变更的升级指南

**对于应用程序：**
- 包含 Docker 镜像版本控制
- 设置部署触发器
- 添加回滚流程

**最佳实践：**
- 始终为修补程序创建发布分支
- 使用主要版本的候选发布版本
- 维护升级指南
- 保持发布小而频繁
- 记录回滚流程

此自动化发布系统提供：
- ✅ 一致的版本控制
- ✅ 自动生成变更日志
- ✅ 清晰的贡献指南
- ✅ 专业的发布说明
- ✅ 减少手动工作
- ✅ 提高项目可维护性